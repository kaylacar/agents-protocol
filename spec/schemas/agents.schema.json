{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agents-protocol.org/schemas/agents.schema.json",
  "title": "agents.json",
  "description": "Machine-readable capability declaration for the agents protocol.",
  "type": "object",
  "required": ["schema_version", "site", "capabilities"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of the agents.json schema.",
      "examples": ["1.0"]
    },
    "site": {
      "type": "object",
      "description": "Identity and contact information for the site.",
      "required": ["name", "url"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable site name.",
          "examples": ["Acme Ceramics"]
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Canonical site URL.",
          "examples": ["https://acmeceramics.example.com"]
        },
        "description": {
          "type": "string",
          "description": "One-line description of what the site does.",
          "examples": ["Handmade ceramic mugs, bowls, and vases"]
        },
        "contact": {
          "type": "string",
          "description": "Contact email or URL for the site operator.",
          "examples": ["support@acmeceramics.example.com"]
        }
      }
    },
    "capabilities": {
      "type": "array",
      "description": "List of capabilities the site exposes to agents.",
      "items": {
        "$ref": "#/definitions/capability"
      },
      "minItems": 1
    },
    "session": {
      "type": "object",
      "description": "Session configuration. Required if any capability has requires_session: true.",
      "properties": {
        "create": {
          "type": "string",
          "description": "URL to create a session via POST.",
          "default": "/.well-known/agents/api/session",
          "examples": ["/.well-known/agents/api/session"]
        },
        "delete": {
          "type": "string",
          "description": "URL to end a session via DELETE.",
          "default": "/.well-known/agents/api/session",
          "examples": ["/.well-known/agents/api/session"]
        },
        "ttl_seconds": {
          "type": "integer",
          "description": "Session time-to-live in seconds.",
          "default": 3600,
          "minimum": 60,
          "examples": [1800, 3600]
        }
      }
    },
    "flows": {
      "type": "array",
      "description": "Suggested multi-step workflows for common tasks.",
      "items": {
        "$ref": "#/definitions/flow"
      }
    },
    "rate_limit": {
      "type": "object",
      "description": "Rate limiting configuration.",
      "properties": {
        "requests_per_minute": {
          "type": "integer",
          "description": "Maximum requests per minute across all endpoints.",
          "minimum": 1,
          "examples": [60]
        }
      }
    },
    "audit": {
      "type": "object",
      "description": "Audit trail configuration (RER integration).",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether audit trails are produced for sessions.",
          "default": false
        },
        "endpoint": {
          "type": "string",
          "description": "URL to retrieve audit artifacts. Includes :session_id placeholder.",
          "examples": ["/.well-known/agents/api/audit/:session_id"]
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the audit endpoint.",
          "examples": ["Retrieve signed RER artifact for a completed session"]
        }
      }
    }
  },
  "definitions": {
    "capability": {
      "type": "object",
      "description": "A single capability the site exposes.",
      "required": ["name", "endpoint", "method"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Capability identifier (e.g., 'search', 'cart.add').",
          "pattern": "^[a-z][a-z0-9_.]*$",
          "examples": ["search", "cart.add"]
        },
        "description": {
          "type": "string",
          "description": "What this capability does, in plain language.",
          "examples": ["Search the product catalog"]
        },
        "endpoint": {
          "type": "string",
          "description": "URL path for this capability, relative to the site origin. May include path parameters (e.g., /:id).",
          "examples": ["/.well-known/agents/api/search", "/.well-known/agents/api/detail/:id"]
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE"],
          "description": "HTTP method for this capability."
        },
        "params": {
          "type": "object",
          "description": "Parameter schema. Keys are parameter names; values describe type and constraints.",
          "additionalProperties": {
            "$ref": "#/definitions/param"
          }
        },
        "requires_session": {
          "type": "boolean",
          "description": "Whether this capability requires an active session.",
          "default": false
        },
        "human_handoff": {
          "type": "boolean",
          "description": "Whether this capability returns a URL for a human to complete the action.",
          "default": false
        }
      }
    },
    "param": {
      "type": "object",
      "description": "Describes a single parameter for a capability.",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["string", "number", "integer", "boolean", "array", "object"],
          "description": "Data type of the parameter."
        },
        "description": {
          "type": "string",
          "description": "What this parameter does."
        },
        "required": {
          "type": "boolean",
          "description": "Whether this parameter is required.",
          "default": false
        },
        "default": {
          "description": "Default value if the parameter is omitted."
        },
        "enum": {
          "type": "array",
          "description": "Allowed values."
        },
        "items": {
          "type": "object",
          "description": "Schema for array items (when type is 'array')."
        }
      }
    },
    "flow": {
      "type": "object",
      "description": "A suggested multi-step workflow.",
      "required": ["name", "steps"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Flow identifier.",
          "examples": ["purchase"]
        },
        "description": {
          "type": "string",
          "description": "What this flow accomplishes.",
          "examples": ["Search for a product, view details, add to cart, and check out"]
        },
        "steps": {
          "type": "array",
          "description": "Ordered list of capability names to call.",
          "items": { "type": "string" },
          "minItems": 2,
          "examples": [["search", "detail", "cart.add", "checkout"]]
        }
      }
    }
  }
}
